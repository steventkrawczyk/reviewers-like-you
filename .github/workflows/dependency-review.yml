# Dependency Review Action
#
# This Action will scan dependency manifest files that change as part of a Pull Request, surfacing known-vulnerable versions of the packages declared or updated in the PR. Once installed, if the workflow run is marked as required, PRs introducing known-vulnerable packages will be blocked from merging.
#
# Source repository: https://github.com/actions/dependency-review-action
# Public documentation: https://docs.github.com/en/code-security/supply-chain-security/understanding-your-software-supply-chain/about-dependency-review#dependency-review-enforcement
name: 'Dependency Review'
on: [pull_request]

permissions:
  contents: read

jobs:
  dependency-review:
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout Repository'
        uses: actions/checkout@v3
      - name: 'Dependency Review'
        uses: actions/dependency-review-action@v2
      - name: python-isort
        uses: isort/isort-action@v1.0.0
        with:
          # Version of isort to use
          isortVersion: # optional, default is latest
          # files or directories to sort
          sortPaths: # optional, default is .
          # isort configuration options
          configuration: # optional, default is --check-only --diff
          # path(s) to requirements files that should be installed to properly configure third-party imports
          requirementsFiles: # optional, default is 
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install flake8 pytest
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
      - name: Pull DynamoDb docker image
        run: |
          docker pull amazon/dynamodb-local
      - name: Generate coverage report
        env:
          AWS_ACCESS_KEY_ID: fakeKeyId
          AWS_SECRET_ACCESS_KEY: fakeAccessKey
          AWS_DEFAULT_REGION: us-west-2
        run: |
          pytest . --cov --cov-branch 
      - name: Pytest coverage comment
        uses: MishaKav/pytest-coverage-comment@main
        with:
          pytest-coverage-path: data/cov.txt
